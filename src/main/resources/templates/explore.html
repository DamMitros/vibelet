<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{fragments/layout :: layout(~{::content})}">
    <head><title>EXPLORE ZONE</title></head>
    <body>
        <div th:fragment="content">

            <div class="neo-box p-2 bg-acid-blue mb-8">
                <form th:action="@{/explore}" method="get" class="flex gap-2">
                    <input type="text" name="query" placeholder="WHO ARE YOU LOOKING FOR?" class="flex-1 border-[3px] border-black p-4 font-head text-xl uppercase placeholder:text-gray-400 focus:outline-none focus:bg-acid-yellow transition">
                    <button type="submit" class="bg-black text-white px-6 border-[3px] border-black hover:bg-white hover:text-black transition font-mono text-2xl">
                        <i class="fa-solid fa-search"></i>
                    </button>
                </form>
            </div>

            <div class="grid gap-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-head text-3xl bg-white border-[3px] border-black inline-block px-4 py-2 transform rotate-1 shadow-neo-sm">
                        <span th:text="${param.query != null} ? 'SEARCH_RESULTS' : 'RECENT_USERS'">RESULTS</span>_//
                    </h2>
                    <span class="font-mono text-xs bg-black text-white px-2 py-1">MAX 20 RESULTS</span>
                </div>

                <div th:if="${searchResults != null}" th:each="user : ${searchResults}" class="neo-box p-4 bg-white flex items-center justify-between group hover:bg-off-white">
                    <div class="flex items-center gap-4">
                        <a th:href="@{'/users/' + ${user.id}}" class="block w-16 h-16 border-[3px] border-black bg-gray-200 overflow-hidden hover:opacity-80 transition">
                            <img th:if="${user.avatarUrl}" th:src="${user.avatarUrl}" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition">
                        </a>
                        <div>
                            <a th:href="@{'/users/' + ${user.id}}" class="font-head text-2xl hover:underline" th:text="${user.username}">USER</a>
                            <div class="mt-1">
                                <span class="font-mono text-xs bg-gray-200 px-2 py-0.5 border border-black" th:text="${user.friendshipStatus}">STATUS</span>
                            </div>
                        </div>
                    </div>

                    <div th:switch="${user.friendshipStatus}" th:id="'action-area-' + ${user.id}">
                        <button th:case="'NONE'" th:onclick="'sendRequest(' + ${user.id} + ')'" class="bg-acid-green border-[3px] border-black p-3 hover:shadow-neo-sm transition active:translate-x-1 active:translate-y-1" title="Add Friend">
                            <i class="fa-solid fa-user-plus text-xl"></i>
                        </button>

                        <button th:case="'PENDING'" class="bg-gray-300 border-[3px] border-black p-3 cursor-not-allowed" title="Pending">
                            <i class="fa-solid fa-clock text-xl"></i>
                        </button>

                        <button th:case="'FRIEND'" class="bg-acid-pink border-[3px] border-black p-3" title="Already Friends">
                            <i class="fa-solid fa-heart text-xl"></i>
                        </button>

                        <div th:case="'SELF'" class="font-mono font-bold border-[3px] border-black p-2 bg-acid-yellow">YOU</div>
                    </div>
                </div>

                <div th:if="${searchResults != null && #lists.isEmpty(searchResults)}" class="neo-box p-8 text-center bg-white border-dashed">
                    <i class="fa-solid fa-ghost text-6xl mb-4"></i>
                    <p class="font-head text-2xl">NOBODY FOUND.</p>
                </div>
            </div>

            <script>
                async function sendRequest(userId) {
                    try {
                        const res = await fetch(`/api/v1/friends/request/${userId}`, { method: 'POST' });
                        if (res.ok) {
                            const container = document.getElementById(`action-area-${userId}`);
                            container.innerHTML = `
                                    <button class="bg-gray-300 border-[3px] border-black p-3 cursor-not-allowed">
                                        <i class="fa-solid fa-clock text-xl"></i>
                                    </button>`;
                        }
                    } catch (e) { console.error(e); }
                }
            </script>
        </div>
    </body>
</html>